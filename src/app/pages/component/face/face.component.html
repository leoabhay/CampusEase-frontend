<div class="attendance-container">
  <div class="attendance-header">
    <h2>Face Attendance System</h2>
    <div class="role-badge">{{ userRole | uppercase }}</div>
  </div>

  <!-- Student Section -->
  <ng-container *ngIf="userRole === 'student'">
    <div class="student-section">
      <div class="input-group mb-3">
  <span class="input-group-text">
    <i class="fas fa-book"></i>
  </span>
  <select
    class="form-select"
    [(ngModel)]="subjectName"
    name="subjectName"
    required
    (click)="populateSubjects()"
  >
    <!-- Default placeholder (only shown when nothing is selected) -->
    <option *ngIf="!subjectName" value="" disabled selected>Select Subject</option>

    <!-- Dynamic options (only shown when dropdown is clicked) -->
    <ng-container *ngIf="subjectsPopulated">
      <option *ngFor="let subj of enrolledSubjects" [value]="subj.name">
        {{ subj.name }}
      </option>
    </ng-container>
  </select>
</div>

      <p class="instruction-text">Please position your face in front of the camera.</p>

      <div class="webcam-container">
        <webcam
          [trigger]="triggerObservable"
          (imageCapture)="handleImage($event)"
          class="webcam-view"
        ></webcam>
      </div>

      <div *ngIf="webcamImage" class="preview-container">
        <p class="preview-title">Your Photo Preview</p>
        <img [src]="webcamImage.imageAsDataUrl" class="preview-image" />
      </div>

      <div class="action-buttons">
        <button (click)="triggerSnapshot()" class="btn btn-capture">
          <i class="fas fa-camera"></i> Capture Photo
        </button>
        <button
          (click)="markAttendance()"
          class="btn btn-submit"
          [disabled]="loading"
        >
          <i class="fas fa-check-circle"></i>
          {{ loading ? 'Processing...' : 'Mark Attendance' }}
        </button>
      </div>
    </div>

    <!-- Student Attendance Table -->
    <div *ngIf="attendanceList.length > 0" class="records-container">
      <h3 class="records-title">My Attendance Records</h3>
      <div class="table-responsive">
        <table class="records-table">
          <thead>
            <tr>
              <th>S.N</th>
              <th>Subject</th>
              <th>Date</th>
              <th>Image</th>
            </tr>
          </thead>
          <tbody>
  <ng-container *ngFor="let record of attendanceList; let i = index">
    <tr>
      <td>{{ i + 1 }}</td>
      <td>{{ record.subjectName || record.subjectCode }}</td>
      <td>{{ record.date | date: 'medium' }}</td>
      <td>
        <button
          *ngIf="record.image"
          class="btn btn-sm btn-view-image"
          (click)="viewImageInNewTab(record.image, record.rollno)"
        >
          <i class="fas fa-image"></i> View Image
        </button>
      </td>
    </tr>
  </ng-container>
</tbody>
        </table>
      </div>
    </div>
  </ng-container>

<!-- FACULTY VIEW -->
<ng-container *ngIf="userRole === 'faculty'">
  <div *ngIf="attendanceList.length > 0" class="records-container">
    <h3 class="records-title">My Subject Attendance Records</h3>
    <div class="table-responsive">
      <table class="records-table">
        <thead>
          <tr>
            <th>Roll No</th>
            <th>Subject</th>
            <th>Date</th>
            <th>Image</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let record of attendanceList">
            <tr>
              <td>{{ record.rollno }}</td>
              <td>{{ record.subjectName || record.subjectCode }}</td>
              <td>{{ record.date | date: 'medium' }}</td>
              <td>
                <button
                  *ngIf="record.image"
                  class="btn btn-sm btn-view-image"
                  (click)="viewImageInNewTab(record.image, record.rollno)">
                  <i class="fas fa-image"></i> View Image
                </button>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</ng-container>

<!-- ADMIN VIEW -->
<ng-container *ngIf="userRole === 'admin'">
  <div *ngIf="attendanceList.length > 0" class="records-container">
    <h3 class="records-title">All Attendance Records</h3>
    <div class="table-responsive">
      <table class="records-table">
        <thead>
          <tr>
            <th>Roll No</th>
            <th>Subject</th>
            <th>Date</th>
            <th>Image</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let record of attendanceList">
            <tr>
              <td>{{ record.rollno }}</td>
              <td>{{ record.subjectName || record.subjectCode }}</td>
              <td>{{ record.date | date: 'medium' }}</td>
              <td>
                <button
                  *ngIf="record.image"
                  class="btn btn-sm btn-view-image"
                  (click)="viewImageInNewTab(record.image, record.rollno)">
                  <i class="fas fa-image"></i> View Image
                </button>
              </td>
              <td>
                <button
                  class="btn btn-delete"
                  (click)="deleteAttendance(record._id)">
                  <i class="fas fa-trash-alt"></i> Delete
                </button>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>
  </div>
</ng-container>

</div>
